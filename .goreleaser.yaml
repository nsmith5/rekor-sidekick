builds:
- env:
  - CGO_ENABLED=0
  goos:
  - linux
  - darwin
  goarch:
  - amd64
  - arm64
  ldflags:
  - "-s -w"
  - "-extldflags=-zrelro"
  - "-extldflags=-znow"
  - "-X github.com/nsmith5/rekor-sidekick/cli.tag={{.Version}}"
  - "-X github.com/nsmith5/rekor-sidekick/cli.commit={{.FullCommit}}"
  - "-X github.com/nsmith5/rekor-sidekick/cli.date={{.CommitDate}}"

gomod:
  proxy: true

checksum:
  name_template: 'checksums.txt'

source:
  enabled: true

sboms:
  - artifacts: archive
  - id: source # Two different sbom configurations need two different IDs
    artifacts: source

signs:
- cmd: cosign
  env:
  - COSIGN_EXPERIMENTAL=1
  certificate: '${artifact}.pem'
  args:
    - sign-blob
    - '--output-certificate=${certificate}'
    - '--output-signature=${signature}'
    - '${artifact}'
  artifacts: checksum
  output: true
